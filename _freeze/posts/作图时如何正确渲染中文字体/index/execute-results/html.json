{
  "hash": "32cef675781975837007aeb2bf85c8b6",
  "result": {
    "markdown": "---\ntitle: \"作图时如何正确渲染中文字体\"\nauthor: \"Boyce\"\ndate: '2023/10/11'\ncategories: [R, ggplot2]\nexecute: \n  warning: false\n---\n\n\n## 正文\n\n在 RStudio 中使用 ggplot 作图时，常常需要指定中文字体，但是 ggplot 无法识别字体的中文名称。\n\n在 MacOS 下又没有一个简便的方式可以查到阿里普惠体、字制区喜脉体等中文字体对应的英文名。在网上查询也不方便且不可靠，因为字体安装的来源不同，英文名也可能不一样。\n\n后来发现使用 systemfonts 包可以很方便地解决这个问题。安装包后，使用 `system_fonts()` 函数 会返回一个表格。表格中有系统下所有已安装的字体名称、字体文件路径、字体家族、字重等等信息，很容易就可以通过筛选功能找到自己所需要的字体名称。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(systemfonts)\nknitr::kable(head(system_fonts()))\n```\n\n::: {.cell-output-display}\n|path                                                                                                                        | index|name                    |family               |style   |weight |width         |italic |monospace |\n|:---------------------------------------------------------------------------------------------------------------------------|-----:|:-----------------------|:--------------------|:-------|:------|:-------------|:------|:---------|\n|/System/Library/Fonts/Supplemental/Shree714.ttc                                                                             |     1|ShreeDev0714-Bold       |Shree Devanagari 714 |Bold    |bold   |normal        |FALSE  |FALSE     |\n|/System/Library/Fonts/Supplemental/Muna.ttc                                                                                 |     0|Muna                    |Muna                 |Regular |normal |normal        |FALSE  |FALSE     |\n|/System/Library/Fonts/Supplemental/Academy Engraved LET Fonts.ttf                                                           |     0|AcademyEngravedLetPlain |Academy Engraved LET |Plain   |normal |normal        |FALSE  |FALSE     |\n|/System/Library/Fonts/Supplemental/Impact.ttf                                                                               |     0|Impact                  |Impact               |Regular |heavy  |semicondensed |FALSE  |FALSE     |\n|/System/Library/AssetsV2/com_apple_MobileAsset_Font7/ad8c3bb76851adc11dc4772c1a7a00caf83e3037.asset/AssetData/Ornanong.ttc  |     1|PSLOrnanongPro-Italic   |PSL Ornanong Pro     |Italic  |normal |normal        |TRUE   |FALSE     |\n|/System/Library/AssetsV2/com_apple_MobileAsset_Font7/5a3fc034b64879656271c040cab38b65d4ea6548.asset/AssetData/LiSongPro.ttf |     0|LiSongPro               |LiSong Pro           |Light   |light  |normal        |FALSE  |FALSE     |\n:::\n:::\n\n\n经查询，阿里普惠体在本地的英文名为 `Alibaba-PuHuiTi-R`。\n\n但在有些情况下，使用 ggplot 时可以正常显示字体，当需要将其保存为 pdf、svg 等文件格式时，会出现无法成功渲染字体的报错。这时候就需要使用 showtext 包来处理，具体使用方法可见[文档](https://cran.rstudio.com/web/packages/showtext/vignettes/introduction.html)。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\n\n# 打开开关，打开后默认使用 showtext 渲染字体\nshowtext_auto()\n\n# 加载字体，family参数为自定义的字体名称，路径为本地字体文件 .ttf 的路径\nfont_add(family = \"PuHuiTi\", regular = \"/Library/Fonts/Alibaba-PuHuiTi-Regular.ttf\")\n\n# 使用字体时，直接填入之前自定义的字体 PuHuiTi\ndf %>%\n  ggplot(aes(x = n, y = hetu)) +\n  geom_col() +\n  theme_ipsum(base_family = \"PuHuiTi\") +\n  ggsave(\"plot.svg\")\n\n# 关闭开关\nshowtext_auto(enable = FALSE)\n```\n:::\n\n\n但这样的方法也有很大的问题：特别是在以 svg 格式保存后，这时设计软件中所有的字体都变成了路径，也就没有了字体的属性，即无法再改成别的字体，或者调整字号、字重等。\n\n## 相关资源\n\n-   [Systemfonts Github Pages](https://github.com/r-lib/systemfonts)\n-   [showtext: Using Fonts More Easily in R Graphs](https://cran.rstudio.com/web/packages/showtext/vignettes/introduction.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}